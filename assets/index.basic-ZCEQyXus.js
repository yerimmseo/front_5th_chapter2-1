(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))c(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&c(s)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function c(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}})();const u=(t,{className:e="",id:o="",attributes:c={},textContent:n="",props:r={}}={})=>{const s=document.createElement(t);return e&&(s.className=e),o&&(s.id=o),n&&(s.textContent=n),Object.entries(c).forEach(([d,a])=>{s.setAttribute(d,a)}),Object.entries(r).forEach(([d,a])=>{s[d]=a}),s},S=t=>document.createTextNode(t),I=()=>{const t=new Set;return{listeners:t,subscribe:c=>t.add(c),notify:()=>t.forEach(c=>c())}},g=(t,e={})=>{const{subscribe:o,notify:c}=I();let n={...t};const r=a=>{n={...n,...a},c()},s=()=>({...n}),d=Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...p)=>{const m=l(s(),...p);return m&&r(m),m}]));return{getState:s,setState:r,subscribe:o,actions:d}},f=(t,e)=>t.find(o=>o.id===e),L=(t,e)=>t.filter(o=>o.id!==e),y={cartItemList:[]},x={addItem:(t,e,o=1)=>{const c=f(t.cartItemList,e.id);return c?c.quantity+=o:t.cartItemList.push({...e,quantity:o}),{cartItemList:[...t.cartItemList]}},updateItemQuantity:(t,e,o)=>{const c=f(t.cartItemList,e);return c?(c.quantity=o,{cartItemList:c.quantity<=0?L(t.cartItemList,e):[...t.cartItemList]}):{cartItemList:[...t.cartItemList]}},removeItem:(t,e)=>({cartItemList:L(t.cartItemList,e)})},v=g(y,x),P={productList:[{id:"p1",name:"상품1",price:1e4,stock:50},{id:"p2",name:"상품2",price:2e4,stock:30},{id:"p3",name:"상품3",price:3e4,stock:20},{id:"p4",name:"상품4",price:15e3,stock:0},{id:"p5",name:"상품5",price:25e3,stock:10}],lastSelectedProduct:null},k={decreaseStock:(t,e,o=1)=>{const c=f(t.productList,e);return!c||c.stock<o?null:(c.stock-=o,{productList:[...t.productList]})},increaseStock:(t,e,o=1)=>!f(t.productList,e)||o<1?null:{productList:t.productList.map(n=>n.id===e?{...n,stock:n.stock+o}:n)},updateStock:(t,e,o)=>{const c=f(t.productList,e);return!c||o<0?null:(c.stock=o,{productList:[...t.productList]})},setLastSelectedProduct:(t,e)=>({lastSelectedProduct:e}),updateProduct:(t,e,o)=>f(t.productList,e)?{productList:t.productList.map(n=>n.id===e?{...n,...o}:n)}:null},C=g(P,k),i={cart:v,product:C},E=()=>u("button",{className:"bg-blue-500 text-white px-4 py-2 rounded",id:"add-to-cart-btn",textContent:"추가"}),N=({productList:t=[]})=>{const e=u("select",{className:"border rounded p-2 mr-2",id:"product-select"});return t.forEach(o=>{const c=u("option",{attributes:{value:o.id},textContent:`${o.name} - ${o.price}원`,props:{disabled:o.stock===0}});e.appendChild(c)}),e},w=()=>{const t=u("div",{className:"text-sm text-gray-500 mt-2",id:"stock-status",textContent:""}),e=()=>{const{productList:o}=i.product.getState();let c="";o.forEach(n=>{n.stock<5&&(c+=`${n.name}: ${n.stock>0?`재고 부족 (${n.stock}개 남음)`:"품절"}
`)}),t.innerText=c.trim()};return e(),i.product.subscribe(e),t},h=({productId:t,amount:e})=>u("button",{className:"quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1",attributes:{"data-product-id":t,"data-change-amount":e},textContent:e>0?"+":"-"}),M=({productId:t})=>u("button",{className:"remove-item bg-red-500 text-white px-2 py-1 rounded",attributes:{"data-product-id":t},textContent:"삭제"}),$=({product:t,quantity:e})=>{const{id:o,name:c,price:n}=t,r=u("div",{className:"flex justify-between items-center mb-2",id:o}),s=u("span",{textContent:`${c} - ${n}원 x ${e}`}),d=u("div"),a=h({productId:o,amount:-1}),l=h({productId:o,amount:1}),p=M({productId:o});return d.append(a,l,p),r.append(s,d),r},A=()=>{const t=u("div",{id:"cart-items"}),e=()=>{const{cartItemList:o}=i.cart.getState();t.innerHTML="",o.forEach(({id:c,quantity:n,...r})=>{t.appendChild($({product:{id:c,...r},quantity:n}))})};return i.cart.subscribe(e),e(),t},O=(t,e)=>{let o=0,c=0,n=0,r=0;if(t.forEach(({id:d,quantity:a})=>{const l=e.find(b=>b.id===d);if(!l)return;const p=l.price*a;c+=a,n+=p;let m=0;a>=10&&(m={p1:.1,p2:.15,p3:.2,p4:.05,p5:.25}[d]||0),o+=p*(1-m)}),c>=30){const d=n*.25,a=n-o;d>a?(o=n*.75,r=.25):r=a/n}else r=(n-o)/n;new Date().getDay()===2&&(o*=.9,r=Math.max(r,.1));const s=Math.floor(o/1e3);return{totalPrice:Math.round(o),discountRate:r,bonusPoint:s}},T=()=>{const t=u("div",{className:"text-xl font-bold my-4",id:"cart-total"}),e=()=>{const{cartItemList:o}=i.cart.getState(),{productList:c}=i.product.getState(),{totalPrice:n,discountRate:r,bonusPoint:s}=O(o,c);t.innerHTML="";const d=S(`총액: ${n}원`);if(t.appendChild(d),r>0){const l=u("span",{className:"text-green-500 ml-2",textContent:`(${(r*100).toFixed(1)}% 할인 적용)`});t.appendChild(l)}const a=u("span",{className:"text-blue-500 ml-2",id:"loyalty-points",textContent:`(포인트: ${s})`});t.appendChild(a)};return i.cart.subscribe(e),e(),t},B=()=>{const t=u("section"),e=u("h1",{className:"text-2xl font-bold mb-4",textContent:"장바구니"});return t.append(e,A(),T()),t},q=t=>{const e=u("div",{className:"bg-gray-100 p-8"}),o=u("div",{className:"max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl p-8"}),c=()=>{const r=i.product.getState().productList;return N({productList:r})};let n=c();o.append(B(),n,E(),w()),e.appendChild(o),t.appendChild(e),i.product.subscribe(()=>{const r=n.value,s=c();s&&(n.replaceWith(s),n=s,r&&(n.value=r))})},D=()=>{document.addEventListener("click",t=>{const e=t.target;if(e&&e.matches("#add-to-cart-btn")){const o=document.getElementById("product-select").value,{productList:c}=i.product.getState(),n=c.find(s=>s.id===o);if(!n){alert("상품을 선택해주세요.");return}if(n.stock<=0){alert("재고가 없습니다.");return}if(!i.product.actions.decreaseStock(o,1)){alert("재고가 부족합니다.");return}i.cart.actions.addItem(n,1),i.product.actions.setLastSelectedProduct(o)}if(e&&e.matches(".quantity-change")){const o=e.dataset.productId,c=Number(e.dataset.changeAmount),{cartItemList:n}=i.cart.getState(),r=n.find(d=>d.id===o);if(!r)return;const s=r.quantity+c;if(s<0){alert("수량은 0보다 작을 수 없습니다.");return}if(i.cart.actions.updateItemQuantity(o,s),c>0){const{productList:d}=i.product.getState(),a=d.find(l=>l.id===o);if(!a||a.stock<c){alert("재고가 부족합니다.");return}i.product.actions.decreaseStock(o,c)}else i.product.actions.increaseStock(o,Math.abs(c))}if(e&&e.matches(".remove-item")){const o=e.dataset.productId,{cartItemList:c}=i.cart.getState(),n=c.find(r=>r.id===o);n&&i.product.actions.increaseStock(o,n.quantity),i.cart.actions.removeItem(o)}})},j=()=>{setTimeout(()=>{setInterval(()=>{const{productList:t}=i.product.getState(),e=t[Math.floor(Math.random()*t.length)];if(Math.random()<.3&&e.stock>0){const o={...e,price:Math.round(e.price*.8)};i.product.actions.updateProduct(e.id,o),alert(`번개세일! ${e.name}이(가) 20% 할인 중입니다!`)}},3e4)},Math.random()*1e4),setTimeout(()=>{setInterval(()=>{const{productList:t}=i.product.getState(),e=i.product.getState().lastSelectedProduct;if(e){const o=t.find(c=>c.id!==e&&c.stock>0);if(o){const c={...o,price:Math.round(o.price*.95)};i.product.actions.updateProduct(o.id,c),alert(`${o.name}은(는) 어떠세요? 지금 구매하시면 5% 추가 할인!`)}}},6e4)},Math.random()*2e4)},Q=()=>{const t=document.getElementById("app");if(!t){console.error("Root Element가 없습니다.");return}q(t),D(),j()};typeof window<"u"&&document.getElementById("app")&&Q();
